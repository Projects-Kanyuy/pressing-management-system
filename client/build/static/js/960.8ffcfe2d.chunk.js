/*! For license information please see 960.8ffcfe2d.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[960],{3280:(e,a,s)=>{s.d(a,{A:()=>l});var t=s(5043),r=s(579);const l=e=>{let{label:a,id:s,type:l="text",value:n,onChange:d,placeholder:o,error:i,required:c,className:p="",inputClassName:m="",disabled:u=!1,prefix:x,prefixIcon:h,suffixIcon:g,helperText:b,containerStyle:v,...y}=e;return(0,r.jsxs)("div",{className:`mb-4 ${p}`,style:v,children:[a&&(0,r.jsx)("label",{htmlFor:s,className:"block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-1",children:a}),(0,r.jsxs)("div",{className:"relative rounded-apple shadow-apple-sm",children:[x&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("span",{className:"text-apple-gray-500 sm:text-sm",children:x})}),h&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.cloneElement(h,{className:"h-5 w-5 text-apple-gray-500 dark:text-apple-gray-400"})}),(0,r.jsx)("input",{type:l,id:s,name:s||y.name,value:null===n||void 0===n?"":n,onChange:d,placeholder:o,required:c,disabled:u,className:`\n                        form-input block w-full sm:text-sm\n                        border-apple-gray-300 focus:border-apple-blue focus:ring-apple-blue\n                        dark:bg-apple-gray-800 dark:border-apple-gray-700 dark:text-apple-gray-100\n                        dark:placeholder-apple-gray-500 dark:focus:border-apple-blue\n                        rounded-apple shadow-apple-sm\n                        ${i?"border-apple-red focus:border-apple-red focus:ring-apple-red":""}\n                        ${x||h?"pl-10":"px-3"}\n                        ${g?"pr-10":"px-3"}\n                        ${m}\n                    `.trim().replace(/\s+/g," "),...y}),g&&(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:g})]}),i&&(0,r.jsx)("p",{className:"mt-1.5 text-xs text-apple-red",children:i}),b&&!i&&(0,r.jsx)("p",{className:"mt-1.5 text-xs text-apple-gray-500 dark:text-apple-gray-400",children:b})]})}},4960:(e,a,s)=>{s.r(a),s.d(a,{default:()=>L});var t=s(5043),r=s(1283),l=s(9621),n=s(6260),d=s(722),o=s(7457),i=s(8148),c=s(4117),p=s(3280),m=s(6174),u=s(7784);const x=(0,u.A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var h=s(9292),g=s(579);const b=e=>{let{filters:a,onFilterChange:s,onResetFilters:r,onApplyFilters:l}=e;const{t:n}=(0,c.Bd)(),[o,i]=(0,t.useState)(!1),u=e=>{s({[e.target.name]:e.target.value})},b=[{value:"",label:n("filterControls.statusOptions.allStatuses")},{value:"Pending",label:n("filterControls.statusOptions.pending")},{value:"Processing",label:n("filterControls.statusOptions.processing")},{value:"Ready for Pickup",label:n("filterControls.statusOptions.readyForPickup")},{value:"Completed",label:n("filterControls.statusOptions.completed")},{value:"Cancelled",label:n("filterControls.statusOptions.cancelled")}],v=[{value:"",label:n("filterControls.paymentOptions.allPayments")},{value:"true",label:n("filterControls.paymentOptions.paid")},{value:"false",label:n("filterControls.paymentOptions.unpaid")}],y=[{value:"",label:n("filterControls.overdueOptions.anyDate")},{value:"true",label:n("filterControls.overdueOptions.overdueOnly")}];return(0,g.jsxs)("div",{className:"mb-6 p-4 bg-apple-gray-50 dark:bg-apple-gray-800/30 rounded-apple-md border border-apple-gray-200 dark:border-apple-gray-700/50",children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-1 items-end",children:[(0,g.jsx)(p.A,{label:n("filterControls.searchReceipt"),name:"receiptNumber",id:"receiptNumberFilter",value:a.receiptNumber,onChange:u,placeholder:"PMS-...",className:"mb-3"}),(0,g.jsx)(p.A,{label:n("filterControls.searchCustomerName"),name:"customerName",id:"customerNameFilter",value:a.customerName,onChange:u,placeholder:n("filterControls.placeholders.customerName"),className:"mb-3"}),(0,g.jsx)(p.A,{label:n("filterControls.searchCustomerPhone"),name:"customerPhone",id:"customerPhoneFilter",value:a.customerPhone,onChange:u,placeholder:n("filterControls.placeholders.customerPhone"),className:"mb-3"}),(0,g.jsx)(m.A,{label:n("filterControls.orderStatus"),name:"status",id:"statusFilter",value:a.status,onChange:u,options:b,className:"mb-3"}),(0,g.jsx)(m.A,{label:n("filterControls.paymentStatus"),name:"paid",id:"paidFilter",value:a.paid,onChange:u,options:v,className:"mb-3"}),(0,g.jsx)(m.A,{label:n("filterControls.dueDate"),name:"overdue",id:"overdueFilter",value:a.overdue,onChange:u,options:y,className:"mb-3"})]}),(0,g.jsxs)("div",{className:"mt-3 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0 sm:space-x-2",children:[(0,g.jsx)(d.A,{onClick:()=>i(!o),variant:"link",size:"sm",className:"text-xs",children:n(o?"filterControls.hideAdvanced":"filterControls.showAdvanced")}),(0,g.jsxs)("div",{className:"flex space-x-2",children:[(0,g.jsx)(d.A,{onClick:r,variant:"secondary",size:"sm",iconLeft:(0,g.jsx)(x,{size:14}),children:n("filterControls.reset")}),(0,g.jsx)(d.A,{onClick:l,variant:"primary",size:"sm",iconLeft:(0,g.jsx)(h.A,{size:14}),children:n("filterControls.applyFilters")})]})]}),o&&(0,g.jsxs)("div",{className:"mt-4 pt-4 border-t border-apple-gray-200 dark:border-apple-gray-700",children:[(0,g.jsx)("p",{className:"text-sm text-apple-gray-500 dark:text-apple-gray-400",children:n("filterControls.advancedDescription")}),(0,g.jsx)(m.A,{label:n("filterControls.serviceType"),name:"serviceType",value:a.serviceType||"",onChange:u,options:[{value:"",label:n("filterControls.serviceOptions.allServices")},{value:"wash",label:n("filterControls.serviceOptions.wash")},{value:"dry clean",label:n("filterControls.serviceOptions.dryClean")},{value:"iron",label:n("filterControls.serviceOptions.iron")}],className:"mb-3"})]})]})};var v=s(5873),y=s(7719);const f=(0,u.A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var j=s(781);const N=(0,u.A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);var C=s(5794),A=s(1536),k=s(6833),P=s(1709),O=s(4653),S=s(8666),w=s(5016),F=s(409);const z=e=>{var a;let{title:s,value:t,icon:r,colorClass:l,isLoading:d}=e;return(0,g.jsx)(n.A,{className:`shadow-apple-sm ${l||"bg-white dark:bg-apple-gray-800"}`,children:(0,g.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm font-medium text-apple-gray-500 dark:text-apple-gray-400 uppercase tracking-wide",children:s}),d?(0,g.jsx)(o.A,{size:"sm",className:"mt-1.5"}):(0,g.jsx)("p",{className:"text-2xl font-semibold text-apple-gray-900 dark:text-apple-gray-100",children:t})]}),r&&(0,g.jsx)("div",{className:"p-2.5 rounded-full "+(null!==(a=r.props.className)&&void 0!==a&&a.includes("text-")?"":"bg-apple-blue/10 text-apple-blue"),children:r})]})})},L=()=>{var e;const{settings:a,loadingSettings:s}=(0,F.I)(),{t:m}=(0,c.Bd)(),{user:u}=(0,w.A)(),[x,h]=(0,t.useState)([]),[L,D]=(0,t.useState)(!0),[$,R]=(0,t.useState)(""),[q,M]=(0,t.useState)({paid:"",overdue:"",customerName:"",status:"",receiptNumber:"",customerPhone:"",page:1,pageSize:10}),[I,E]=(0,t.useState)({currentPage:1,totalPages:1,totalOrders:0}),[T,_]=(0,t.useState)({total:0,pending:0,ready:0,overdue:0}),[B,H]=(0,t.useState)(0),[G,J]=(0,t.useState)(!0),[W,V]=(0,t.useState)(""),[K,Q]=(0,t.useState)(!1),[U,X]=(0,t.useState)(null),[Y,Z]=(0,t.useState)(""),[ee,ae]=(0,t.useState)(!1),[se,te]=(0,t.useState)(""),[re,le]=(0,t.useState)(""),[ne,de]=(0,t.useState)(!1),[oe,ie]=(0,t.useState)(null),[ce,pe]=(0,t.useState)(""),me=(null===a||void 0===a?void 0:a.defaultCurrencySymbol)||"$",ue=(0,t.useCallback)(async()=>{console.log("[DashboardPage] --- Initiating loadOrders ---"),console.log("[DashboardPage] Current filters for fetchOrders:",JSON.stringify(q,null,2)),D(!0),R("");try{const{data:e}=await(0,l.Gb)(q);console.log("[DashboardPage] RAW API Response from fetchOrders:",JSON.stringify(e,null,2)),e&&Array.isArray(e.orders)?h(e.orders):(h([]),console.warn("[DashboardPage] API response 'data.orders' is not an array or is missing.")),E({currentPage:e.page||1,totalPages:e.pages||0,totalOrders:e.totalOrders||0})}catch(s){var e,a;const t=(null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||m("dashboard.ordersError");R(t),h([]),E({currentPage:1,totalPages:0,totalOrders:0})}finally{D(!1)}},[q]);(0,t.useEffect)(()=>{new Date;_({total:I.totalOrders,pending:x.filter(e=>["Pending","Processing"].includes(e.status)).length,ready:x.filter(e=>"Ready for Pickup"===e.status).length,overdue:x.filter(e=>e.expectedPickupDate&&(0,P.R)((0,O.H)(e.expectedPickupDate))&&!["Completed","Cancelled"].includes(e.status)).length})},[x,I.totalOrders]);const xe=(0,t.useCallback)(async()=>{if("admin"===(null===u||void 0===u?void 0:u.role)){J(!0),V("");try{const e=(0,S.GP)(new Date,"yyyy-MM-dd"),{data:a}=await(0,l.P7)(e);H(a.totalAmountFromOrdersWithActivity||0)}catch(s){var e,a;V(m("dashboard.dailyPaymentsError")),console.error("Fetch Daily Payments Error for Dashboard:",(null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||s.message||s)}finally{J(!1)}}else V("")},[u]);(0,t.useEffect)(()=>{ue(),xe()},[ue,xe]);const he=e=>{e>=1&&e<=I.totalPages&&e!==I.currentPage&&!L&&M(a=>({...a,page:e}))},ge=e=>{X(e),Z(""),te(""),le(""),Q(!0)},be=()=>{Q(!1),X(null)};let ve;return ve=L&&0===x.length&&!$?(0,g.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,g.jsx)(o.A,{size:"lg"})}):$?(0,g.jsxs)("div",{className:"p-4 text-center text-apple-red bg-red-50 dark:bg-red-900/30 rounded-apple",children:[(0,g.jsx)(y.A,{size:24,className:"mx-auto mb-2"}),$]}):L||0!==x.length?(0,g.jsxs)(g.Fragment,{children:[L&&x.length>0&&(0,g.jsx)("div",{className:"absolute inset-0 bg-white/50 dark:bg-black/50 flex items-center justify-center z-10 rounded-b-apple-lg",children:(0,g.jsx)(o.A,{})}),(0,g.jsx)(i.A,{orders:x,onRecordPaymentClick:ge}),I.totalOrders>0&&I.totalPages>1&&(0,g.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row justify-between items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm text-apple-gray-600 dark:text-apple-gray-400",children:m("dashboard.pageInfo",{currentPage:I.currentPage,totalPages:I.totalPages,totalOrders:I.totalOrders})}),(0,g.jsxs)("div",{className:"flex space-x-2",children:[(0,g.jsx)(d.A,{onClick:()=>he(I.currentPage-1),disabled:1===I.currentPage||L,variant:"secondary",size:"sm",children:m("dashboard.previous")}),(0,g.jsx)(d.A,{onClick:()=>he(I.currentPage+1),disabled:I.currentPage>=I.totalPages||L,variant:"secondary",size:"sm",children:m("dashboard.next")})]})]})]}):(0,g.jsx)("div",{className:"py-10 text-center text-apple-gray-500 dark:text-apple-gray-400",children:m("dashboard.noOrdersFound")}),(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,g.jsx)("h1",{className:"text-2xl sm:text-3xl font-semibold text-apple-gray-800 dark:text-apple-gray-100",children:m("dashboard.title")}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsxs)(d.A,{onClick:()=>de(e=>!e),variant:"secondary",size:"md",iconLeft:(0,g.jsx)(f,{size:16}),children:[m("dashboard.filters")," ",m(ne?"dashboard.filtersHide":"dashboard.filtersShow")]}),(0,g.jsx)(r.N_,{to:"/app/orders/new",children:(0,g.jsx)(d.A,{variant:"primary",size:"md",iconLeft:(0,g.jsx)(j.A,{size:18}),children:m("dashboard.createNewOrder")})})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:["admin"===(null===u||void 0===u?void 0:u.role)&&(0,g.jsx)(z,{title:m("dashboard.todaysSales"),value:`${me} ${"number"===typeof B?B.toFixed(2):"0.00"}`,icon:(0,g.jsx)(N,{size:24,className:"text-green-500"}),isLoading:G}),(0,g.jsx)(z,{title:m("dashboard.totalOrders"),value:String(I.totalOrders),icon:(0,g.jsx)(C.A,{size:24,className:"text-apple-blue"}),isLoading:L&&0===I.totalOrders&&!$}),(0,g.jsx)(z,{title:m("dashboard.pendingProcessing"),value:String(T.pending),icon:(0,g.jsx)(A.A,{size:24,className:"text-apple-orange"}),isLoading:L&&0===x.length&&!$}),(0,g.jsx)(z,{title:m("dashboard.readyForPickup"),value:String(T.ready),icon:(0,g.jsx)(k.A,{size:24,className:"text-apple-green"}),isLoading:L&&0===x.length&&!$}),(0,g.jsx)(z,{title:m("dashboard.overdueOrders"),value:String(T.overdue),icon:(0,g.jsx)(y.A,{size:24,className:"text-apple-red"}),colorClass:T.overdue>0?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700":"",isLoading:L&&0===x.length&&!$})]}),W&&(0,g.jsx)("p",{className:"text-xs text-center text-red-500 mt-1",children:W}),ne&&(0,g.jsx)(n.A,{title:m("dashboard.filterOrders"),className:"mb-6",children:(0,g.jsx)(b,{filters:q,onFilterChange:e=>M(a=>({...a,...e,page:1})),onResetFilters:()=>M({paid:"",overdue:"",customerName:"",status:"",receiptNumber:"",customerPhone:"",page:1,pageSize:10}),onApplyFilters:ue})}),(0,g.jsx)(n.A,{title:m("dashboard.orderList"),className:"overflow-visible relative",contentClassName:"p-0 sm:p-0",children:(0,g.jsx)("div",{className:"px-4 sm:px-6 pb-6 relative",children:ve})}),K&&U&&(0,g.jsx)(v.A,{isOpen:K,onClose:be,title:m("dashboard.recordPayment",{receiptNumber:U.receiptNumber}),size:"md",children:(0,g.jsxs)("div",{className:"space-y-4",children:[re&&(0,g.jsxs)("p",{className:"p-3 text-sm bg-green-100 text-apple-green rounded-apple flex items-center",children:[(0,g.jsx)(k.A,{size:18,className:"mr-2"}),re]}),se&&(0,g.jsxs)("p",{className:"p-3 text-sm bg-red-100 text-apple-red rounded-apple flex items-center",children:[(0,g.jsx)(y.A,{size:18,className:"mr-2"}),se]}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("p",{className:"text-sm",children:[(0,g.jsxs)("strong",{children:[m("dashboard.customer"),":"]})," ",null===(e=U.customer)||void 0===e?void 0:e.name]}),(0,g.jsxs)("p",{className:"text-sm",children:[(0,g.jsxs)("strong",{children:[m("dashboard.totalAmount"),":"]})," ",me,(U.totalAmount||0).toFixed(2)]}),(0,g.jsxs)("p",{className:"text-sm",children:[(0,g.jsxs)("strong",{children:[m("dashboard.currentlyPaid"),":"]})," ",me,(U.amountPaid||0).toFixed(2)]}),(0,g.jsxs)("p",{className:"text-sm font-semibold",children:[m("dashboard.balanceDue"),": ",me,Math.max(0,(U.totalAmount||0)-(U.amountPaid||0)).toFixed(2)]})]}),(0,g.jsx)(p.A,{label:m("dashboard.paymentAmountToAdd"),id:"paymentAmountInputModal",type:"number",value:Y,onChange:e=>Z(e.target.value),placeholder:m("dashboard.enterAmount"),min:"0.01",step:"0.01",disabled:ee,required:!0,autoFocus:!0}),(0,g.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,g.jsx)(d.A,{variant:"secondary",onClick:be,disabled:ee,children:m("dashboard.cancel")}),(0,g.jsx)(d.A,{variant:"primary",onClick:async()=>{if(!U||!Y)return void te(m("dashboard.paymentAmountRequired"));const e=parseFloat(Y);if(isNaN(e)||e<=0)te(m("dashboard.validAmountRequired"));else{ae(!0),te(""),le("");try{const a=U,s=(a.amountPaid||0)+e;s>a.totalAmount&&console.warn("Payment exceeds total amount due. Backend should handle this.");const{data:r}=await(0,l.Vl)(a._id,{amountPaid:s});le(m("dashboard.paymentSuccess",{amount:`${me}${e.toFixed(2)}`,receiptNumber:r.receiptNumber})),t=r,h(e=>e.map(e=>e._id===t._id?t:e)),(t.isFullyPaid||U&&t.amountPaid>U.amountPaid)&&xe(),X(t),setTimeout(be,2e3)}catch(r){var a,s;te((null===(a=r.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||m("dashboard.paymentError"))}finally{ae(!1)}var t}},isLoading:ee,disabled:ee,children:m("dashboard.submitPayment")})]})]})})]})}},6174:(e,a,s)=>{s.d(a,{A:()=>r});s(5043);var t=s(579);const r=e=>{let{label:a,id:s,value:r,onChange:l,options:n=[],placeholder:d,error:o,required:i,className:c="",selectClassName:p="",disabled:m=!1,...u}=e;return(0,t.jsxs)("div",{className:`mb-4 ${c}`,children:[a&&(0,t.jsxs)("label",{htmlFor:s,className:"block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-1",children:[a," ",i&&(0,t.jsx)("span",{className:"text-apple-red",children:"*"})]}),(0,t.jsxs)("select",{id:s,name:s||u.name,value:r,onChange:l,required:i,disabled:m,className:`\n                    \n        form-select block w-full sm:text-sm\n        border-apple-gray-300 focus:border-apple-blue focus:ring-apple-blue\n        dark:bg-apple-gray-800 dark:border-apple-gray-700 dark:text-apple-gray-100\n        dark:focus:border-apple-blue\n        rounded-apple shadow-apple-sm\n    \n                    ${o?"\n        border-apple-red focus:border-apple-red focus:ring-apple-red\n        dark:border-apple-red dark:focus:border-apple-red\n    ":""}\n                    ${p}\n                `.trim().replace(/\s+/g," "),...u,children:[d&&(0,t.jsx)("option",{value:"",children:d}),n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,t.jsx)("p",{className:"mt-1.5 text-xs text-apple-red",children:o})]})}},9292:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(7784).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])}}]);
//# sourceMappingURL=960.8ffcfe2d.chunk.js.map