AWSTemplateFormatVersion: 2010-09-09
Description: "Creates in AWS Secrets Manager a secret for a third party service"
Parameters:
  EnvId:
    Type: String
    Description: Environment Id (used to namespace resources)
    AllowedPattern: "[a-z][a-z0-9]{2,19}"
    ConstraintDescription: Must be lower case letters between 3 and 20 characters.

Resources:
  MongoDBSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/mongodb"
      GenerateSecretString:
        SecretStringTemplate: '{"mongo_uri": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  CloudinarySecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/cloudinary"
      GenerateSecretString:
        SecretStringTemplate: '{"cloudinary_cloud_name": "placeholder", "cloudinary_api_key": "placeholder", "cloudinary_api_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  FapshiSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/fapshi"
      GenerateSecretString:
        SecretStringTemplate: '{"fapshi_api_user": "placeholder", "fapshi_api_key": "placeholder", "fapshi_base_url": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  JWTSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/jwt"
      GenerateSecretString:
        SecretStringTemplate: '{"jwt_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


  AdminSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/admin"
      GenerateSecretString:
        SecretStringTemplate: '{"admin_email": "placeholder", "admin_password": "placeholder", "admin_jwt_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


Outputs:
  MongoDBSecretArn:
    Description: "Mongo DB Secret ARN"
    Value: !Ref MongoDBSecret

  CloudinarySecretArn:
    Description: "Cloudinary Secret ARN"
    Value: !Ref CloudinarySecret

  FapshiSecretArn:
    Description: "Fapshi Secret ARN"
    Value: !Ref FapshiSecret

  JWTSecretArn:
    Description: "JWT Secret ARN"
    Value: !Ref JWTSecret

  AdminSecretArn:
    Description: "Admin Secret ARN"
    Value: !Ref AdminSecret