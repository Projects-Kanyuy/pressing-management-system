AWSTemplateFormatVersion: 2010-09-09
Description: "Creates in AWS Secrets Manager a secret for a third party service"
Parameters:
  EnvId:
    Type: String
    Description: Environment Id (used to namespace resources)
    AllowedPattern: "^[a-z][a-z0-9-]{2,49}$"
    ConstraintDescription: Must be lower case letters, digits, or hyphens (3-50 characters).

Resources:
  MongoDBSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/mongodb"
      GenerateSecretString:
        SecretStringTemplate: '{"mongo_uri": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  CloudinarySecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/cloudinary"
      GenerateSecretString:
        SecretStringTemplate: '{"cloudinary_cloud_name": "placeholder", "cloudinary_api_key": "placeholder", "cloudinary_api_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


  JWTSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/jwt"
      GenerateSecretString:
        SecretStringTemplate: '{"jwt_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


  AdminSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/admin"
      GenerateSecretString:
        SecretStringTemplate: '{"admin_email": "placeholder", "admin_password": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  SmtpSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/smtp"
      GenerateSecretString:
        SecretStringTemplate: '{"host": "placeholder", "port": "465", "user": "placeholder", "from": "placeholder", "secure": "true"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  TwilioSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/twilio"
      GenerateSecretString:
        SecretStringTemplate: '{"account_sid": "placeholder", "auth_token": "placeholder", "whatsapp_from_number": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

  DirectoryAdminSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/directory_admin"
      GenerateSecretString:
        SecretStringTemplate: '{"user": "placeholder", "pass_hash": "placeholder", "jwt_secret": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


  ExchangeRateSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/exchange_rate"
      GenerateSecretString:
        SecretStringTemplate: '{"api_key": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId


  AccountpeSecret:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: !Sub "/${EnvId}/accountpe"
      GenerateSecretString:
        SecretStringTemplate: '{"email": "placeholder", "payin_base_url": "placeholder"}'
        GenerateStringKey: "password"
        PasswordLength: 30
        ExcludePunctuation: true
      Tags:
        - Key: EnvId
          Value: !Ref EnvId

Outputs:
  MongoDBSecretArn:
    Description: "Mongo DB Secret ARN"
    Value: !Ref MongoDBSecret

  CloudinarySecretArn:
    Description: "Cloudinary Secret ARN"
    Value: !Ref CloudinarySecret

  JWTSecretArn:
    Description: "JWT Secret ARN"
    Value: !Ref JWTSecret

  AdminSecretArn:
    Description: "Admin Secret ARN"
    Value: !Ref AdminSecret

  SmtpSecretArn:
    Description: "SMTP Secret ARN"
    Value: !Ref SmtpSecret

  TwilioSecretArn:
    Description: "Twilio Secret ARN"
    Value: !Ref TwilioSecret

  DirectoryAdminSecretArn:
    Description: "Directory admin Secret ARN"
    Value: !Ref DirectoryAdminSecret

  ExchangeRateSecretArn:
    Description: "Exchange rate Secret ARN"
    Value: !Ref ExchangeRateSecret

  AccountpeSecretArn:
    Description: "Accountpe Secret ARN"
    Value: !Ref AccountpeSecret